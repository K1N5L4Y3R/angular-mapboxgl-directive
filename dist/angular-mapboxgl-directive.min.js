/*!
*  angular-mapboxgl-directive 0.1.0 2016-08-31
*  An AngularJS directive for Mapbox GL
*  git: git+https://github.com/Naimikan/angular-mapboxgl-directive.git
*/
!function(a,b,c){"use strict";a.module("mapboxgl-directive",[]).directive("mapboxgl",["$q","mapboxglUtils","mapboxglConstants",function(c,d,e){function f(a){this._mapboxGlMap=c.defer(),this.getMap=function(){return this._mapboxGlMap.promise},this.getMapboxGlScope=function(){return a}}function g(c,f,g,h){if(!b)throw new Error("Mapbox GL does not included");if(!b.accessToken)throw new Error("Mapbox access token does not defined");if(!b.supported())throw new Error("Your browser does not support Mapbox GL");c.mapboxglMapId=g.id?g.id:d.generateMapId(),f.attr("id",c.mapboxglMapId);var i=function(){isNaN(g.width)?f.css("width",g.width):f.css("width",g.width+"px")},j=function(){isNaN(g.height)?f.css("height",g.height):f.css("height",g.height+"px")};a.isDefined(g.width)&&(i(),c.$watch(function(){return f[0].getAttribute("width")},function(){i()})),a.isDefined(g.height)&&(j(),c.$watch(function(){return f[0].getAttribute("height")},function(){j()}));var k=new b.Map({container:c.mapboxglMapId,style:e.defaultStyle,center:e.defaultCenter,interactive:c.isInteractive||!0});h._mapboxGlMap.resolve(k),c.$on("$destroy",function(){k.remove()})}var h={restrict:"EA",replace:!0,scope:{glStyle:"=",glCenter:"=",glMinZoom:"=",glMaxZoom:"=",glZoom:"=",glBearing:"=",glPitch:"=",glControls:"=",glFilter:"=",glClasses:"=",isInteractive:"="},transclude:!0,template:'<div class="angular-mapboxgl-map"><div ng-transclude></div></div>',controller:f,link:g};return f.$inject=["$scope"],h}]),a.module("mapboxgl-directive").factory("mapboxglUtils",["$window",function(b){function c(){return"mapbox-gl-map-"+Date.now()}function d(c){if(a.isDefined(c)){if(!a.isDefined(c.autodiscover)||!c.autodiscover)return a.isNumber(c.lat)&&a.isNumber(c.lng)&&(c.lng>-180||c.lng<180)&&(c.lat>-90||c.lat<90)?[c.lng,c.lat]:!!(a.isArray(c)&&2===c.length&&a.isNumber(c[0])&&a.isNumber(c[1])&&(c[0]>-180||c[0]<180)&&(c[1]>-90||c[1]<90))&&c;b.navigation.geolocation.getCurrentPosition(function(a){var b=a.coords;return[b.longitude,b.latitude]},function(a){console.warn("ERROR("+a.code+"): "+a.message)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}return!1}var e={generateMapId:c,validateAndFormatCenter:d};return e}]),a.module("mapboxgl-directive").constant("mapboxglConstants",{defaultStyle:"mapbox://styles/mapbox/streets-v9",defaultCenter:[0,0]}),a.module("mapboxgl-directive").directive("glBearing",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glBearing",function(c){if(!a.isNumber(c))throw new Error("Invalid bearing");b.setBearing(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glCenter",["mapboxglUtils",function(a){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glCenter",function(c){if(c=a.validateAndFormatCenter(c),!c)throw new Error("Invalid center");b.panTo(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glClasses",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glClasses",function(c){if(a.isDefined(c))a.isArray(c)&&b.setClasses(c);else{var d=b.getClasses();d.map(function(a){b.removeClass(a)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glControls",[function(){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h={};f.getMap().then(function(c){g.$watch("glControls",function(d){if(a.isDefined(d)&&(a.isDefined(d.navigation)&&a.isDefined(d.navigation.enabled)&&d.navigation.enabled&&(h.navigation=new b.Navigation({position:d.navigation.position||"top-right"}),c.addControl(h.navigation)),a.isDefined(d.scale)&&a.isDefined(d.scale.enabled)&&d.scale.enabled&&(h.scale=new b.Scale({position:d.scale.position||"bottom-left"}),c.addControl(h.scale)),a.isDefined(d.attribution)&&a.isDefined(d.attribution.enabled)&&d.attribution.enabled&&(h.attribution=new b.Attribution({position:d.attribution.position||"bottom-right"}),c.addControl(h.attribution)),a.isDefined(d.geolocate)&&a.isDefined(d.geolocate.enabled)&&d.geolocate.enabled&&(h.geolocate=new b.Geolocate({position:d.geolocate.position||"top-left"}),c.addControl(h.geolocate)),a.isDefined(d.draw)&&a.isDefined(d.draw.enabled)&&d.draw.enabled)){if(!a.isDefined(b.Draw)||!a.isFunction(b.Draw))throw new Error("mapboxgl.Draw plugin is not included.");var e={};e.position=d.draw.position||"top-right",a.isDefined(d.draw.drawOptions)&&a.extend(e,d.draw.drawOptions),h.draw=new b.Draw(e),c.addControl(h.draw)}},!0)})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glFilter",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glFilter",function(c){if(a.isDefined(c))if(Object.prototype.toString.call(c)===Object.prototype.toString.call({})){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)}else{if(Object.prototype.toString.call(c)!==Object.prototype.toString.call([]))throw new Error("Invalid filter parameter");c.map(function(c){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMaxBounds",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxBounds",function(c){if(!a.isArray(c)||2!==c.length)throw new Error("Invalid max bounds");b.setMaxBounds(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMaxZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid max zoom");b.setMaxZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMinZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMinZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid min zoom");b.setMinZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glPitch",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glPitch",function(c){if(!a.isNumber(c)||!(c>=0||c<=60))throw new Error("Invalid pitch");b.setPitch(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glStyle",[function(){function a(a,b,c,d){if(!d)throw new Error("Invalid angular-mapboxgl-directive controller");var e=d.getMapboxGlScope();d.getMap().then(function(a){e.$watch("glStyle",function(b){a.setStyle(b)},!0)})}var b={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:a};return b}]),a.module("mapboxgl-directive").directive("glZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid zoom");b.setZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}])}(angular,mapboxgl);